<UserControl x:Class="Presentation.Views.EquipmentSheetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:grid="clr-namespace:Syncfusion.UI.Xaml.Grid;assembly=Syncfusion.SfGrid.WPF"
             xmlns:sf="http://schemas.syncfusion.com/wpf"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:localization="clr-namespace:Resources.Localization;assembly=Resources"
             xmlns:behaviors="clr-namespace:Common.Behaviors;assembly=Common"
             xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             syncfusionskin:SfSkinManager.Theme="{syncfusionskin:SkinManagerExtension ThemeName=Windows11Light}"
             SnapsToDevicePixels="True"
             mc:Ignorable="d">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/MenuAdv/MenuAdv.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/SfDataGrid/SfDataGrid.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/mscontrol/checkbox.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/mscontrol/scrollviewer.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/mscontrol/combobox.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Syncfusion.Themes.Windows11Light.WPF;component/DateTimeEdit/DateTimeEdit.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Presentation;component/Resources/Icons/Icons.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Presentation;component/Styles/ContextMenuStyle.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Presentation;component/Styles/ClearImageStyle.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources;component/Templates/SfDataGrid.Templates.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources;component/Styles/SfDataGrid.Styles.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources;component/Styles/Image.Styles.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources;component/Global/Brushes.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            
            <Style x:Key="BasedGridCellStyle" TargetType="grid:GridCell" BasedOn="{StaticResource SyncfusionGridCellStyle}">
                <Setter Property="BorderBrush" Value="Gray"/>
                <Setter Property="BorderThickness" Value="0.5"/>
            </Style>
            
            <Style TargetType="grid:GridRowHeaderCell" BasedOn="{StaticResource SyncfusionGridRowHeaderCellStyle}">
                <Setter Property="Template" Value="{StaticResource GridRowHeaderTemplate}"/>
            </Style>
            
            
        </ResourceDictionary>
    </UserControl.Resources>
    
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding UserControlLoadedCommand}"
                                  CommandParameter="{Binding ElementName=UserControl}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        
        <Grid>

            <sf:ToolBarManager>
                <sf:ToolBarManager.TopToolBarTray>
                    <sf:ToolBarTrayAdv>
                        <sf:ToolBarAdv Style="{StaticResource DefaultSfToolBarStyle}">
                            <ContentControl ContentTemplate="{StaticResource SfDataGridTopToolBarContent}">
                                <i:Interaction.Behaviors>
                                    <behaviors:SfDataGridToolBarBehavior
                                        SearchHelper="{Binding SearchHelper, ElementName=SfDataGrid}"
                                        RefreshCommand="{Binding RefreshDataGridCommand}"
                                        PrintCommand="{Binding PrintCommand}"
                                        ImportFromExcelCommand="{Binding ExcelImportCommand}"
                                        ExportToExcelCommand="{Binding ExportToExcelCommand}"
                                        ExportToPdfCommand="{Binding ExportToPdfCommand}"
                                        ColumnSettingsCommand="{Binding OpenColumnsDesignerCommand}" />
                                </i:Interaction.Behaviors>
                            </ContentControl>
                        </sf:ToolBarAdv>
                    </sf:ToolBarTrayAdv>
                </sf:ToolBarManager.TopToolBarTray>
                <sf:ToolBarManager.Content>
                    <grid:SfDataGrid x:Name="SfDataGrid"
                                     IsDynamicItemsSource="True"
                                     AutoGenerateColumns="True"
                                     ColumnSizer="None"
                                     EditTrigger="OnDoubleTap"
                                     SelectionUnit="Row"
                                     SelectionMode="Extended"
                                     GridValidationMode="None"
                                     LiveDataUpdateMode="AllowDataShaping"
                                     GridCopyOption="CopyData"
                                     GridPasteOption="PasteData"
                                     AllowDeleting="True"
                                     AllowDraggingColumns="True"
                                     AllowDraggingRows="True"
                                     AllowDrop="True"
                                     AllowResizingColumns="True"
                                     AllowResizingHiddenColumns="True"
                                     AllowSelectionOnPointerPressed="True"
                                     CanMaintainScrollPosition="True"
                                     HeaderRowHeight="30"
                                     FrozenColumnCount="{Binding FrozenColumnCount}"
                                     ShowRowHeader="True"
                                     ShowGroupDropArea="True"
                                     GroupDropAreaText="Перетягніть сюди, щоб групувати"
                                     ShowBusyIndicator="True"
                                     AddNewRowPosition="Top"
                                     AddNewRowText="Двічі натисніть, щоб додати"
                                     GridLinesVisibility="Both"
                                     EditorSelectionBehavior="SelectAll"
                                     EnableDataVirtualization="True"
                                     ScrollMode="Async"
                                     NewItemPlaceholderPosition="AtBeginning"
                                     CurrentCellBorderBrush="{StaticResource PrimaryDark1.Brush}"
                                     CurrentCellBorderThickness="1"
                                     RowDropIndicatorMode="Line"
                                     FontSize="14">

                        <grid:SfDataGrid.ItemsSource>
                            <Binding Path="Items" />
                        </grid:SfDataGrid.ItemsSource>

                        <grid:SfDataGrid.Columns>
                            <Binding Path="Columns" />
                        </grid:SfDataGrid.Columns>

                        <grid:SfDataGrid.SelectedItems>
                            <Binding Path="SelectedItems" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" />
                        </grid:SfDataGrid.SelectedItems>

                        <grid:SfDataGrid.ContextMenu>
                            <ContextMenu Style="{StaticResource ContextMenuStyle}">
                                <MenuItem Header="{x:Static localization:Strings.MarkForDelete}"
                                          Command="{Binding MarkRowForDeleteCommand}"
                                          Visibility="{Binding MarkForDeleteContextMenuItemVisibility, 
                              Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <MenuItem.Icon>
                                        <Image Source="{StaticResource DeleteRowColoredLine64}"
                                               Style="{StaticResource SmallImageStyle}" />
                                    </MenuItem.Icon>
                                </MenuItem>

                                <MenuItem Header="{x:Static localization:Strings.UnmarkForDelete}"
                                          Command="{Binding UnmarkRowForDeleteCommand}"
                                          Visibility="{Binding UnmarkForDeleteContextMenuItemVisibility, 
                              Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </ContextMenu>
                        </grid:SfDataGrid.ContextMenu>

                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="Loaded">
                                <i:InvokeCommandAction Command="{Binding DataGridLoadedCommand}"
                                                       CommandParameter="{Binding ElementName=SfDataGrid}" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="SelectionChanged">
                                <i:InvokeCommandAction Command="{Binding SelectionChangedCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="RecordDeleting">
                                <i:InvokeCommandAction Command="{Binding KeyRemoveRowCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="KeyDown">
                                <i:InvokeCommandAction Command="{Binding DataGridKeyDownCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="FilterItemsPopulated">
                                <i:InvokeCommandAction Command="{Binding FilterItemsPopulatedCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="CurrentCellValidated">
                                <i:InvokeCommandAction Command="{Binding CurrentCellValidatedCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="CurrentCellValidating">
                                <i:InvokeCommandAction Command="{Binding CurrentCellValidatingCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="CurrentCellEndEdit">
                                <i:InvokeCommandAction Command="{Binding CurrentCellEndEditCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="AddNewRowInitiating">
                                <i:InvokeCommandAction Command="{Binding AddNewRowInitiatingCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="RowValidated">
                                <i:InvokeCommandAction Command="{Binding RowValidatedCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="RowValidating">
                                <i:InvokeCommandAction Command="{Binding RowValidatingCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="QueryColumnDragging">
                                <i:InvokeCommandAction Command="{Binding QueryColumnDraggingCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="ResizingColumns">
                                <i:InvokeCommandAction Command="{Binding ResizingColumnCommand}"
                                                       PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>

                        <grid:SfDataGrid.Resources>
                            <Style x:Key="BasedGridHeaderStyle" TargetType="grid:GridHeaderCellControl" BasedOn="{StaticResource SyncfusionGridHeaderCellControlStyle}"/>
                        </grid:SfDataGrid.Resources>
                    </grid:SfDataGrid>
                </sf:ToolBarManager.Content>
            </sf:ToolBarManager>
            

        <!-- Empty data messages -->
        <TextBlock Grid.Row="0"  
                   Text="Характеристики відсутні" 
                   Visibility="{Binding ColumnsEmptyTipVisibility, Converter={StaticResource BooleanToVisibilityConverter}}" 
                   VerticalAlignment="Center" 
                   HorizontalAlignment="Center" 
                   FontFamily="Segoe UI" 
                   Foreground="{StaticResource Black.Brush}" 
                   FontSize="14"/>
        
        <TextBlock Grid.Row="0"  
                   Text="Записи відсутні" 
                   Visibility="{Binding RowsEmptyTipVisibility, Converter={StaticResource BooleanToVisibilityConverter}}" 
                   VerticalAlignment="Center" 
                   HorizontalAlignment="Center" 
                   FontFamily="Segoe UI" 
                   Foreground="{StaticResource Black.Brush}" 
                   FontSize="14"/>
        </Grid>
        
        
    <!-- Overlay content -->
    <ContentControl Grid.Row="0"
                    Content="{Binding OverlayContent}"
                    Visibility="{Binding IsOverlayVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    
    <!-- Busy indicator -->
    <sf:SfBusyIndicator Grid.Row="0" 
                        Panel.ZIndex="6" 
                        Foreground="{StaticResource Primary.Brush}" 
                        Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}" 
                        AnimationType="DotCircle" 
                        VerticalAlignment="Center" 
                        HorizontalAlignment="Center"/>
    
    
    <!-- Dialog content -->
    <ContentControl Grid.Row="0"
                    Content="{Binding DialogContent}"
                    Visibility="{Binding IsDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Panel.ZIndex="6"/>
    </Grid>
</UserControl>